<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>通过 Swagger 定义自动生成 Mock 数据 | 橘子的前端杂记</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="个人博客。记录实际开发中遇到的问题及解决方案，日常的思考和总结、面试知识点、读书笔记等。">
    <link rel="preload" href="/assets/css/0.styles.f0586a5e.css" as="style"><link rel="preload" href="/assets/js/app.615a9105.js" as="script"><link rel="preload" href="/assets/js/2.0dd58d28.js" as="script"><link rel="preload" href="/assets/js/16.0e967ed2.js" as="script"><link rel="preload" href="/assets/js/3.41cd40d7.js" as="script"><link rel="prefetch" href="/assets/js/10.dccf4510.js"><link rel="prefetch" href="/assets/js/11.0a10a79b.js"><link rel="prefetch" href="/assets/js/12.aadb6ebe.js"><link rel="prefetch" href="/assets/js/13.ed9f0830.js"><link rel="prefetch" href="/assets/js/14.e1fad49b.js"><link rel="prefetch" href="/assets/js/15.8e54fdc5.js"><link rel="prefetch" href="/assets/js/17.5612c4ae.js"><link rel="prefetch" href="/assets/js/18.140dca17.js"><link rel="prefetch" href="/assets/js/4.a6fe8922.js"><link rel="prefetch" href="/assets/js/5.09621231.js"><link rel="prefetch" href="/assets/js/6.b8ceee3a.js"><link rel="prefetch" href="/assets/js/7.462463df.js"><link rel="prefetch" href="/assets/js/8.e3e73f0a.js"><link rel="prefetch" href="/assets/js/9.903c794c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f0586a5e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">橘子的前端杂记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开源项目" class="dropdown-title"><span class="title">开源项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="开源项目" class="mobile-dropdown-title"><span class="title">开源项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/reeli/ts-codegen" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ts-codegen
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/reeli/swagger-faker" target="_blank" rel="noopener noreferrer" class="nav-link external">
  swagger-faker
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/reeli/react-rx-form" target="_blank" rel="noopener noreferrer" class="nav-link external">
  react-rx-form
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/reeli/sketch-svg-to-react-component" target="_blank" rel="noopener noreferrer" class="nav-link external">
  sketch-svg-to-react-component
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/reeli/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开源项目" class="dropdown-title"><span class="title">开源项目</span> <span class="arrow down"></span></button> <button type="button" aria-label="开源项目" class="mobile-dropdown-title"><span class="title">开源项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/reeli/ts-codegen" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ts-codegen
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/reeli/swagger-faker" target="_blank" rel="noopener noreferrer" class="nav-link external">
  swagger-faker
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/reeli/react-rx-form" target="_blank" rel="noopener noreferrer" class="nav-link external">
  react-rx-form
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/reeli/sketch-svg-to-react-component" target="_blank" rel="noopener noreferrer" class="nav-link external">
  sketch-svg-to-react-component
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/reeli/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Framework</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/framework_react-hooks-use.html" class="sidebar-link">React Hooks 你真的用对了吗？</a></li><li><a href="/blog/framework_react-hooks-principle.html" class="sidebar-link">React Hooks 原理剖析</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>RxJS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/rxjs_reactive-programming.html" class="sidebar-link">RxJS 系列故事(1)——理解响应式编程</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>SVG</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/svg_deep-learning-svg-1.html" class="sidebar-link">SVG 基础</a></li><li><a href="/blog/svg_deep-learning-svg-2.html" class="sidebar-link">SVG 坐标系统</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>核心模型</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/models_authorization.html" class="sidebar-link">基于 RBAC 的前端权限控制</a></li><li><a href="/blog/models_request.html" class="sidebar-link">基于 React 和 Redux 的 API 集成解决方案</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>性能优化</span> <!----></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>打包</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/build_webpack-tree-shaking.html" class="sidebar-link">聊聊 Webpack Tree shaking</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>部署</span> <!----></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>自动化工具</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/tools_swagger-to-mocks.html" aria-current="page" class="active sidebar-link">通过 Swagger 定义自动生成 Mock 数据</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/tools_swagger-to-mocks.html#处理-swagger-json" class="sidebar-link">处理 Swagger JSON</a></li><li class="sidebar-sub-header"><a href="/blog/tools_swagger-to-mocks.html#生成-mock-数据" class="sidebar-link">生成 Mock 数据</a></li><li class="sidebar-sub-header"><a href="/blog/tools_swagger-to-mocks.html#生成-mock-server-配置" class="sidebar-link">生成 Mock Server 配置</a></li></ul></li><li><a href="/blog/tools_ts-codegen.html" class="sidebar-link">搭建前后端之桥</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="通过-swagger-定义自动生成-mock-数据"><a href="#通过-swagger-定义自动生成-mock-数据" class="header-anchor">#</a> 通过 Swagger 定义自动生成 Mock 数据</h1> <p>我最近的在做的项目是一个前后端分离的项目，前后端由不同的团队分别开发，并且前端的进度经常领先后端。这就意味着，当前端在开发一个新功能时，API 可能还没有准备好。不过，我们会先和后端先商议好 API Schema，然后使用 Mock 数据进行开发。</p> <p>但问题也随之而来，定义 Mock 数据并配置 mock server 真的太浪费时间了！我真的非常讨厌这种没有任何技术含量的「苦力活」。所以，只好想办法让生成 Mock 数据的过程「自动化」。那么，从哪里生成这些 Mock 数据呢？突然想到了开发时使用的 Swagger UI，它提供的 Swagger JSON 准确地定义了所有的 API Schema。因此，我们可以通过 Swagger JSON 去自动生成 Mock 数据。</p> <p>本篇文章会介绍如何通过 Swagger 定义去生成 Mock 数据以及 Mock Server 的配置。主要内容包括：</p> <ul><li><p>Swagger 简介</p></li> <li><p>通过 Swagger JSON 生成 Mock 数据</p> <ul><li><p>处理 Swagger JSON</p></li> <li><p>生成 Mock 数据</p></li> <li><p>生成 Mock Server 配置</p></li></ul></li></ul> <p>本文所有代码都在这个仓库 <a href="https://github.com/reeli/swagger-faker" target="_blank" rel="noopener noreferrer">swagger-faker<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h1 id="swagger-简介"><a href="#swagger-简介" class="header-anchor">#</a> Swagger 简介</h1> <p>在介绍 Swagger 之前，你需要先了解一下 <a href="https://swagger.io/specification/" target="_blank" rel="noopener noreferrer">OpenAPI 规范<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。因为 Swagger 定义是基于 OpenAPI 规范的。</p> <blockquote><p>OpenAPI 规范（OAS）为 RESTful API 定义了一个与语言无关的标准接口，允许人和计算机发现和理解服务的功能，而无需通过访问源代码、文档或开发者工具。</p></blockquote> <p>OpenAPI 定义大致如下：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;swagger&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;info&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;host&quot;</span><span class="token operator">:</span> <span class="token string">&quot;petstore.swagger.io&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;basePath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/v2&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;schemes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;paths&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;/user/logout&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;get&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">&quot;user&quot;</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;summary&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Logs out current logged in user session&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;operationId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;logoutUser&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;produces&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">&quot;application/xml&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;application/json&quot;</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;parameters&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;responses&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;successful operation&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;securityDefinitions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;definitions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;externalDocs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p><a href="https://petstore.swagger.io/v2/swagger.json" target="_blank" rel="noopener noreferrer">查看完整 OpenAPI 定义示例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>通过上面的示例，我们可以清楚地知道，/user/logout 用于注销当前已登录的用户会话。它是一个 GET 请求，且不接收任何请求参数。当然，清楚地描述一个 API 意味着要定义很多东西。你可能会觉得 OpenAPI 定义写起来有点麻烦？不用担心，在实际工作中，我们会通过注解的方式自动生成 OpenAPI 定义。</p> <p>基于 OpenAPI 定义，我们还可以完成很多事情。比如自动生成服务器和客户端代码（Swagger Codegen）、通过交互式的 UI 来可视化服务接口（Swagger UI）等等。</p> <h1 id="通过-swagger-json-生成-mock-数据"><a href="#通过-swagger-json-生成-mock-数据" class="header-anchor">#</a> 通过 Swagger JSON 生成 Mock 数据</h1> <h2 id="处理-swagger-json"><a href="#处理-swagger-json" class="header-anchor">#</a> 处理 Swagger JSON</h2> <p>要生成 Mock 数据，我们应该从 Swagger JSON 中获取哪些内容？我从 <a href="https://petstore.swagger.io/v2/swagger.json" target="_blank" rel="noopener noreferrer">这个 Swagger JSON<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 中截取了一段数据，如下所示。仔细观察下面的内容并思考这个问题。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;paths&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;/pet/findByStatus&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;get&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;pet&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;summary&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Finds Pets by status&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Multiple status values can be provided with comma separated strings&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;operationId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;findPetsByStatus&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;produces&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;application/xml&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;parameters&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;status&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;in&quot;</span><span class="token operator">:</span> <span class="token string">&quot;query&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Status values that need to be considered for filter&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;array&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;items&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
              <span class="token property">&quot;enum&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;available&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pending&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sold&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;available&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;collectionFormat&quot;</span><span class="token operator">:</span> <span class="token string">&quot;multi&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;responses&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;200&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;successful operation&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;schema&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;array&quot;</span><span class="token punctuation">,</span>
              <span class="token property">&quot;items&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;$ref&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#/definitions/Pet&quot;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">&quot;400&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Invalid status value&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;security&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;petstore_auth&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;write:pets&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;read:pets&quot;</span><span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p>从上面的例子中可以发现，对于一个请求来说，我们需要的 Mock 数据就是它成功响应之后的数据。也就是说，对于 Swagger JSON，我们需要关心 <code>responses</code> 中 HTTP Status Code 为 2xx 的数据。但是 <code>response</code> 可能会引用 definitions 中定义的数据。因此，为了生成 Mock 数据，我们还需要处理 <code>$ref</code>，也就是用 Definitions 中定义的数据替换它。</p> <h2 id="生成-mock-数据"><a href="#生成-mock-数据" class="header-anchor">#</a> 生成 Mock 数据</h2> <p>处理好 response 之后，就可以生成 Mock 数据了。因为 Swagger JSON 中可以为 response 或者每一个 property 定义 examples/example，所以使用 examples/example 来生成 Mock 数据一定是最准确的。因此，我们会优先使用 examples/example。如果没有定义 examples/example，我们就通过 <code>type</code> 定义的数据类型去生成。</p> <p>因为 <a href="https://github.com/marak/Faker.js/" target="_blank" rel="noopener noreferrer">faker.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 能让我们更方便地去生成 Mock 数据，因此这里选用了它。你可以像下面这样，构造一些方法，去生成不同类型的假数据。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> faker <span class="token keyword">from</span> <span class="token string">&quot;faker&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getRandomArrayItem</span> <span class="token operator">=</span> <span class="token punctuation">(</span>items<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> items<span class="token punctuation">[</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> items<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">booleanGenerator</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> faker<span class="token punctuation">.</span>random<span class="token punctuation">.</span><span class="token function">boolean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">stringGenerator</span> <span class="token operator">=</span> <span class="token punctuation">(</span>enumList<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>enumList <span class="token operator">?</span> <span class="token function">getRandomArrayItem</span><span class="token punctuation">(</span>enumList<span class="token punctuation">)</span> <span class="token operator">:</span> faker<span class="token punctuation">.</span>random<span class="token punctuation">.</span><span class="token function">words</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">numberGenerator</span> <span class="token operator">=</span> <span class="token punctuation">(</span>max<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> min<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  faker<span class="token punctuation">.</span>random<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    min<span class="token punctuation">,</span>
    max<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">fileGenerator</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> faker<span class="token punctuation">.</span>system<span class="token punctuation">.</span><span class="token function">mimeType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="生成-mock-server-配置"><a href="#生成-mock-server-配置" class="header-anchor">#</a> 生成 Mock Server 配置</h2> <p>除了生成 Mock 数据之外，很多时候我们还需要配置 Mock Server。就拿我们常用的 <a href="https://github.com/typicode/json-server" target="_blank" rel="noopener noreferrer">JSON Server<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 来说，我们还需要配置一些额外的东西。比如在 db.json 中配置路由对应的 Mock 数据，在 routes.json 中自定义路由规则等。</p> <p>因此，我们还需要从 response 中获取更多的内容，包括 path、basePath、method、response 和 queryParams，如下所示：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/pet/findByStatus&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;basePath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/v2&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;method&quot;</span><span class="token operator">:</span> <span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;response&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">93645</span><span class="token punctuation">,</span>
      <span class="token string">&quot;category&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">85609</span><span class="token punctuation">,</span>
        <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;open-source&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;doggie&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;photoUrls&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;firewall Berkshire withdrawal&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string">&quot;tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token string">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">13201</span><span class="token punctuation">,</span>
          <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Salad synthesize e-business&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string">&quot;status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pending&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;queryParams&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>生成 JSON Server 中的自定义路由时，我们可以根据规则，使用 basePath, path 和 queryParams 拼接即可。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// routes.json</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;/v2/pet/findByStatus?status=:status&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./findPetsByStatus&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>最后，将这些数据写入对应的文件中便大功告成了。</p> <h1 id="最后"><a href="#最后" class="header-anchor">#</a> 最后</h1> <p>生成 Mock 数据的过程中还是有很多细节需要处理，感兴趣的同学可以去这个仓库 <a href="https://github.com/reeli/swagger-faker" target="_blank" rel="noopener noreferrer">swagger-faker<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 查看源码。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/reeli/blog/edit/master/docs/blog/tools_swagger-to-mocks.md" target="_blank" rel="noopener noreferrer">本文源码地址</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">9/8/2020, 7:35:28 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/build_webpack-tree-shaking.html" class="prev">
        聊聊 Webpack Tree shaking
      </a></span> <span class="next"><a href="/blog/tools_ts-codegen.html">
        搭建前后端之桥
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.615a9105.js" defer></script><script src="/assets/js/2.0dd58d28.js" defer></script><script src="/assets/js/16.0e967ed2.js" defer></script><script src="/assets/js/3.41cd40d7.js" defer></script>
  </body>
</html>
